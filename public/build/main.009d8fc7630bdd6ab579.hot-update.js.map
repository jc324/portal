{"version":3,"file":"main.009d8fc7630bdd6ab579.hot-update.js","sources":["C:/Users/baeyun/Documents/bukharim96/HWW/halalwatchworld-portal/src/views/reviewer/requests/ReviewRequestMenu.tsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport {\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  Typography,\r\n  LinearProgress,\r\n  Link,\r\n} from \"@material-ui/core\";\r\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport CloudDownloadIcon from \"@material-ui/icons/CloudDownload\";\r\nimport VisibilityIcon from \"@material-ui/icons/Visibility\";\r\nimport AlternateEmailOutlinedIcon from \"@material-ui/icons/AlternateEmailOutlined\";\r\nimport InsertDriveFileIcon from \"@material-ui/icons/InsertDriveFile\";\r\nimport AssignmentIcon from \"@material-ui/icons/Assignment\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport SaveOutlinedIcon from \"@material-ui/icons/SaveOutlined\";\r\nimport VisibilityOutlinedIcon from \"@material-ui/icons/VisibilityOutlined\";\r\nimport CheckCircleOutlineIcon from \"@material-ui/icons/CheckCircleOutline\";\r\nimport BlockIcon from \"@material-ui/icons/Block\";\r\nimport { useSnackbar } from \"notistack\";\r\n\r\nimport Auth from \"../../../api/Auth\";\r\nimport {\r\n  ReviewRequest,\r\n  ReviewRequestStatus,\r\n} from \"../../reviewer/common/types\";\r\nimport NestedMenuItem from \"../../reviewer/common/NestedMenuItem\";\r\n\r\ninterface ReviewRequestMenuProps {\r\n  reviewRequest: ReviewRequest;\r\n  onDeleteReviewRequest: (id: number) => void;\r\n}\r\n\r\nexport default function ReviewRequestMenu({\r\n  reviewRequest,\r\n  onDeleteReviewRequest,\r\n}: ReviewRequestMenuProps) {\r\n  const user = new Auth().user;\r\n  const [anchorEl, setAnchorEl] = useState(null);\r\n  const [loading, setLoading] = useState<boolean>(false);\r\n  const { enqueueSnackbar } = useSnackbar();\r\n  const navigate = useNavigate();\r\n\r\n  const handleClick = (event: any) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const gotoReviewRequestReview = (id: number) =>\r\n    navigate(`/reviewer/clients/request/${id}/review`);\r\n\r\n  const gotoReviewRequestReports = (id: number) =>\r\n    navigate(`/reviewer/clients/request/${id}/reports`);\r\n\r\n  const assumeOwnershipHandler = () => {\r\n    const data = { reviewer_id: user?.id as number };\r\n    const reviewerNameTableCell = document.querySelector(\r\n      `#review-request-${reviewRequest.id as number} .request-reviewer`\r\n    );\r\n    const tableRowAvatar = document.querySelector(\r\n      `#review-request-${reviewRequest.id as number} .MuiAvatar-root`\r\n    );\r\n    const avatar = document.createElement(\"img\");\r\n\r\n    avatar.className = \"MuiAvatar-img\";\r\n    avatar.setAttribute(\r\n      \"src\",\r\n      document\r\n        .querySelector(\"#sidenav-avatar .MuiAvatar-img\")\r\n        ?.getAttribute(\"src\") || \"\"\r\n    );\r\n\r\n    setLoading(true);\r\n    axios\r\n      .post(\r\n        `/api/client/review-request/${\r\n          reviewRequest.id as number\r\n        }/assign-reviewer`,\r\n        data\r\n      )\r\n      .then(async (response) => {\r\n        setLoading(false);\r\n        if (response.status == 200 || response.status == 201) {\r\n          if (reviewerNameTableCell) {\r\n            reviewerNameTableCell.textContent = user?.name as string;\r\n            if (tableRowAvatar) {\r\n              if (tableRowAvatar.firstChild)\r\n                tableRowAvatar.removeChild(tableRowAvatar.firstChild);\r\n              tableRowAvatar.appendChild(avatar);\r\n              tableRowAvatar.classList.remove(\"MuiAvatar-colorDefault\");\r\n            }\r\n            reviewRequest.reviewer_id = user?.id as number;\r\n          }\r\n          enqueueSnackbar(\"Self assigned review request successfully.\", {\r\n            variant: \"success\",\r\n          });\r\n        } else\r\n          enqueueSnackbar(\r\n            \"Failed to self assign review request. Contact the developer.\",\r\n            {\r\n              variant: \"error\",\r\n            }\r\n          );\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        setLoading(false);\r\n        enqueueSnackbar(\r\n          \"Failed to self assign client. Check your network connection and try again.\",\r\n          {\r\n            variant: \"error\",\r\n          }\r\n        );\r\n      });\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const contactClient = (reviewRequest: ReviewRequest) => {\r\n    let email = reviewRequest.client_email || \"\";\r\n    let subject = `Halal Watch World | RE: Document Submission #${reviewRequest.id}`;\r\n\r\n    window.location.assign(\r\n      `mailto:${email}?Subject=${encodeURIComponent(subject)}`\r\n    ); //  + \"&body=\" + encodeURIComponent(bod)\r\n  };\r\n\r\n  const updateStatus = (id: number, status: ReviewRequestStatus) => {\r\n    const statusTableCell = document.querySelector(\r\n      `#review-request-${id} .request-status`\r\n    );\r\n    let statusStr = status.toString();\r\n    let data = { status: statusStr.replace(/\\s/g, \"_\") };\r\n\r\n    setLoading(true);\r\n    axios\r\n      .put(`/api/client/review-request/${reviewRequest.id}/status`, data)\r\n      .then(async (response) => {\r\n        setLoading(false);\r\n        if (response.status == 200 || response.status == 201) {\r\n          if (statusTableCell) statusTableCell.textContent = statusStr;\r\n          enqueueSnackbar(\"Review request status updated successfully.\", {\r\n            variant: \"success\",\r\n          });\r\n        } else\r\n          enqueueSnackbar(\r\n            \"Failed to update review request status. Contact the reviewer.\",\r\n            {\r\n              variant: \"error\",\r\n            }\r\n          );\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        setLoading(false);\r\n        enqueueSnackbar(\r\n          \"Failed to update review request status. Check your network connection and try again.\",\r\n          {\r\n            variant: \"error\",\r\n          }\r\n        );\r\n      });\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const deleteReviewRequest = () => {\r\n    const answer = window.confirm(\r\n      \"Are you sure you would like to delete this review request?\"\r\n    );\r\n\r\n    if (!answer) return;\r\n\r\n    setLoading(true);\r\n    axios\r\n      .delete(`/api/client/review-request/${reviewRequest.id}`)\r\n      .then(async (response) => {\r\n        setLoading(false);\r\n        if (response.status == 200 || response.status == 201) {\r\n          onDeleteReviewRequest(reviewRequest.id as number);\r\n          enqueueSnackbar(\"Review request deleted successfully.\", {\r\n            variant: \"success\",\r\n          });\r\n        } else\r\n          enqueueSnackbar(\r\n            \"Failed to delete review request. Contact the reviewer.\",\r\n            {\r\n              variant: \"error\",\r\n            }\r\n          );\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        setLoading(false);\r\n        enqueueSnackbar(\r\n          \"Failed to delete review request. Check your network connection and try again.\",\r\n          {\r\n            variant: \"error\",\r\n          }\r\n        );\r\n      });\r\n\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        edge=\"end\"\r\n        size=\"small\"\r\n        aria-controls=\"review-request-menu\"\r\n        aria-haspopup=\"true\"\r\n        onClick={handleClick}\r\n      >\r\n        <MoreVertIcon />\r\n      </IconButton>\r\n      <Menu\r\n        id=\"review-request-menu\"\r\n        anchorEl={anchorEl}\r\n        keepMounted\r\n        open={Boolean(anchorEl)}\r\n        onClose={() => setAnchorEl(null)}\r\n      >\r\n        {loading && <LinearProgress />}\r\n\r\n        <MenuItem\r\n          onClick={() => gotoReviewRequestReview(reviewRequest.id as number)}\r\n          // disabled={reviewRequest.status !== \"DRAFT\"}\r\n          // disabled\r\n        >\r\n          <VisibilityIcon />\r\n          <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n            Review\r\n          </Typography>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={() => gotoReviewRequestReports(reviewRequest.id as number)}\r\n          // disabled={reviewRequest.status !== \"DRAFT\"}\r\n          // disabled\r\n        >\r\n          <InsertDriveFileIcon />\r\n          <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n            Reports\r\n          </Typography>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={assumeOwnershipHandler}\r\n          disabled={reviewRequest.reviewer_id === user?.id}\r\n        >\r\n          <AssignmentIcon />\r\n          <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n            Assign\r\n          </Typography>\r\n        </MenuItem>\r\n        <MenuItem onClick={() => contactClient(reviewRequest)}>\r\n          <AlternateEmailOutlinedIcon />\r\n          <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n            Contact Client\r\n          </Typography>\r\n        </MenuItem>\r\n        <MenuItem\r\n          component={Link}\r\n          href={`/reviewer/clients/request/${\r\n            reviewRequest.id as number\r\n          }/documents`}\r\n        >\r\n          <CloudDownloadIcon />\r\n          <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n            Download Documents\r\n          </Typography>\r\n        </MenuItem>\r\n        <NestedMenuItem\r\n          label={\r\n            <>\r\n              <AssignmentTurnedInIcon />\r\n              <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n                Set Status\r\n              </Typography>\r\n            </>\r\n          }\r\n          parentMenuOpen={Boolean(anchorEl)}\r\n        >\r\n          <MenuItem\r\n            onClick={() =>\r\n              updateStatus(\r\n                reviewRequest.id as number,\r\n                ReviewRequestStatus.DRAFT\r\n              )\r\n            }\r\n          >\r\n            <SaveOutlinedIcon />\r\n            <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n              DRAFT\r\n            </Typography>\r\n          </MenuItem>\r\n          <MenuItem\r\n            onClick={() =>\r\n              updateStatus(\r\n                reviewRequest.id as number,\r\n                ReviewRequestStatus.SUBMITTED\r\n              )\r\n            }\r\n          >\r\n            <AssignmentTurnedInIcon />\r\n            <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n              SUBMITTED\r\n            </Typography>\r\n          </MenuItem>\r\n          <MenuItem\r\n            onClick={() =>\r\n              updateStatus(\r\n                reviewRequest.id as number,\r\n                ReviewRequestStatus.IN_REVIEW\r\n              )\r\n            }\r\n          >\r\n            <VisibilityOutlinedIcon />\r\n            <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n              IN REVIEW\r\n            </Typography>\r\n          </MenuItem>\r\n          <MenuItem\r\n            onClick={() =>\r\n              updateStatus(\r\n                reviewRequest.id as number,\r\n                ReviewRequestStatus.APPROVED\r\n              )\r\n            }\r\n          >\r\n            <CheckCircleOutlineIcon />\r\n            <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n              APPROVED\r\n            </Typography>\r\n          </MenuItem>\r\n          <MenuItem\r\n            onClick={() =>\r\n              updateStatus(\r\n                reviewRequest.id as number,\r\n                ReviewRequestStatus.REJECTED\r\n              )\r\n            }\r\n          >\r\n            <BlockIcon />\r\n            <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n              REJECTED\r\n            </Typography>\r\n          </MenuItem>\r\n        </NestedMenuItem>\r\n        <MenuItem\r\n          onClick={deleteReviewRequest}\r\n          // disabled={reviewRequest.status !== \"DRAFT\"}\r\n        >\r\n          <DeleteIcon />\r\n          <Typography variant=\"inherit\" style={{ marginLeft: 10 }}>\r\n            Delete\r\n          </Typography>\r\n        </MenuItem>\r\n      </Menu>\r\n    </>\r\n  );\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AAOA;AACA;AACA;AAFA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAGA;AAEA;AACA;AAOA;AACA;AAQA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AADA;AAGA;AAIA;AADA;AAIA;AAEA;AACA;AACA;AAGA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAAA;AAEA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AAIA;AADA;AAIA;AAEA;AACA;AACA;AAGA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AAIA;AAEA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AAIA;AADA;AAIA;AAEA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAEA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAEA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AArUA;AAOA;;;AAPA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}